### 解决多数据情况下策略提前结束的问题

#### 背景
backtrader-master文件夹中的backtrader是原始的带元类的版本，现在的backtrader是移除元类的版本，原始的版本是正确的，现在的版本存在一些细节上的问题:

1. 在一个数据情况下，没有发现策略会提前结束的情况，都是可以一直运行到最后。在有多个长度不一致，结束日期不一致的数据的情况下，可能在第一个数据到期了，策略就结束了。
2. 性能上有一些降低，在后续进行改进优化的时候，尽可能不要降低效率。
3. backtrader中访问数据的一些惯例
```
data = self.datas[0]
data1 = self.datas[1]
# 收盘价序列
close_list = data.close
# 当日价格
close = close_list[0]
# 前一日价格
pre_close = close_list[-1]
# 下个交易日价格
next_close = close_list[1]

# 当前日期
current_date = data.datetime.date(0)
# 前一日时间
pre_date = data.datetime.date(-1)
# 下个交易日时间
next_date = data.datetime.date(1)

```
4. 多数据情况下的特殊处理：会获取所有的数据的下一个时间，当移动到下一个时间之后，如果这个数据在下一个交易日没有交易，那么，在系统时间到下个交易日的时候，访问[0]的时候，获取的之前的价格和时间，[1]获取的是下一个有交易的交易日的价格和时间，如果这个数据已经没有交易了，那么，访问[1]就报错，越界

#### 解决方案
0. backtrader-master版本的源代码是正确的，不能进行修改
1. 尝试分析定位下是不是因为某个数据到期导致的策略结束
2. 尝试修复相关的bug，尤其是需要关注line和feed相关的数据，bug很可能出在line和feed相关的实现文件中。
3. 每次修改过代码之后，需要pip install -U .  重新安装backtrader，让代码生效
4. 测试的时候增加一个超时功能，20s超时结束，避免陷入死循环
5. 实现pytest tests/strategies/test_multi_extend_data.py 这个能够运行成功
6. 不允许修改测试文件，尤其是不能修改里面的期望数据，需要修改底层的代码
7. 如果修改通过，需要满足 pytest tests -n 10  里面的测试用例都能全部通过。
