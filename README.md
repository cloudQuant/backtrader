# backtrader

[![Python](https://img.shields.io/badge/Python-3.9%2B-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-GPLv3-green.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20macOS%20%7C%20Linux-lightgrey.svg)]()

**[English](README.en.md)** | **ä¸­æ–‡**

---

## ä»‹ç»

åŸºäº backtrader æ‰“é€ æœ€å¥½ç”¨çš„é‡åŒ–æŠ•ç ”å·¥å…·ï¼ˆä¸­ä½é¢‘ä¸ºä¸»ï¼Œåç»­æ”¹å†™æˆ C++ ç‰ˆæœ¬åæ”¯æŒé«˜é¢‘äº¤æ˜“ï¼‰

- **master åˆ†æ”¯**ï¼šä¸å®˜æ–¹ä¸»æµ backtrader å¯¹é½ï¼Œä»…å¢åŠ éƒ¨åˆ†åŠŸèƒ½ã€ä¿®å¤ bugï¼Œå¯è¿è¡Œ CSDN ä¸“æ é‡Œçš„ç­–ç•¥
- **dev åˆ†æ”¯**ï¼šå¼€å‘æ–°åŠŸèƒ½ï¼Œå°è¯• C++ åº•å±‚é‡å†™ï¼Œæ”¯æŒ tick çº§åˆ«å›æµ‹ï¼Œå®Œå–„åå°†åˆå¹¶åˆ° master

### ä¸»è¦ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½å›æµ‹**ï¼šæ”¯æŒå‘é‡åŒ–å’Œäº‹ä»¶é©±åŠ¨ä¸¤ç§æ¨¡å¼
- ğŸ“Š **Plotly äº¤äº’å›¾è¡¨**ï¼šæ”¯æŒ 10 ä¸‡+ æ•°æ®ç‚¹çš„é«˜æ€§èƒ½äº¤äº’å¼å›¾è¡¨
- ğŸ“ˆ **ä¸€é”®ç”ŸæˆæŠ¥å‘Š**ï¼šHTML/PDF/JSON æ ¼å¼çš„ä¸“ä¸šå›æµ‹æŠ¥å‘Š
- ğŸ”§ **ä¸°å¯Œçš„åˆ†æå™¨**ï¼šå¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤ã€SQN ç­‰å…¨é¢æŒ‡æ ‡
- ğŸ“¦ **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰ç­–ç•¥å’ŒæŒ‡æ ‡

---

## å®‰è£…æ•™ç¨‹
```markdown
# å®‰è£…python3.11, python3.11æœ‰æ€§èƒ½ä¸Šçš„æå‡ï¼Œå¹¶ä¸”å¾ˆå¤šåŒ…éƒ½å·²ç»æ”¯æŒï¼Œä¸‹é¢æ˜¯anacondaçš„ä¸€äº›é•œåƒï¼Œä»…ä¾›å‚è€ƒ
# winï¼šhttps://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2023.09-0-Windows-x86_64.exe
# mac mç³»åˆ—: https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2023.09-0-MacOSX-arm64.sh
# ubuntu:https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2023.09-0-Linux-x86_64.sh

# å…‹éš†é¡¹ç›®
git clone https://gitee.com/yunjinqi/backtrader.git
# å®‰è£…ä¾èµ–é¡¹
pip install -r ./backtrader/requirements.txt
# ç¼–è¯‘cythonæ–‡ä»¶å¹¶è¿›è¡Œå®‰è£…, macå’Œ ubuntuä¸‹ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤ã€‚æœ‰ä¸€ä¸ªåªèƒ½åœ¨windowsä¸Šæ‰èƒ½ç¼–è¯‘æˆåŠŸï¼Œä¼šæŠ¥é”™ï¼Œå¿½ç•¥å°±å¥½
cd ./backtrader/backtrader && python -W ignore compile_cython_numba_files.py && cd .. && cd .. && pip install -U ./backtrader/
# ç¼–è¯‘cythonæ–‡ä»¶å¹¶è¿›è¡Œå®‰è£…, windowsä¸‹ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤
cd ./backtrader/backtrader; python -W ignore compile_cython_numba_files.py; cd ..; cd ..; pip install -U ./backtrader/
# è¿è¡Œæµ‹è¯•
pytest ./backtrader/tests -n 4
```

#### ä½¿ç”¨è¯´æ˜

1. [å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£å’Œè®ºå›](https://www.backtrader.com/)
2. [å‚è€ƒæˆ‘åœ¨csdnçš„ä»˜è´¹ä¸“æ ](https://blog.csdn.net/qq_26948675/category_10220116.html)
3. tså’Œcsçš„ä½¿ç”¨è¯´æ˜ï¼šhttps://yunjinqi.blog.csdn.net/article/details/130507409
4. ç½‘ç»œä¸Šä¹Ÿæœ‰å¾ˆå¤šçš„backtraderçš„å­¦ä¹ èµ„æºï¼Œå¤§å®¶å¯ä»¥ç™¾åº¦

#### Plotlyç»‘å›¾ï¼ˆé«˜æ€§èƒ½äº¤äº’å¼å›¾è¡¨ï¼‰

é’ˆå¯¹å¤§æ•°æ®é‡åœºæ™¯ï¼Œæ–°å¢äº†Plotlyç»‘å›¾åç«¯ï¼Œç›¸æ¯”matplotlibæœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š
- **é«˜æ€§èƒ½**: æ”¯æŒ10ä¸‡+æ•°æ®ç‚¹ï¼Œä¸å¡é¡¿
- **äº¤äº’å¼**: æ”¯æŒç¼©æ”¾ã€å¹³ç§»ã€Hoveræ˜¾ç¤ºæ•°æ®
- **è”åŠ¨**: å¤šå­å›¾å…±äº«Xè½´ï¼Œè”åŠ¨æ“ä½œ

##### åŸºæœ¬ä½¿ç”¨
```python
import backtrader as bt

cerebro = bt.Cerebro()
# ... æ·»åŠ ç­–ç•¥å’Œæ•°æ® ...
cerebro.run()

# ä½¿ç”¨Plotlyåç«¯ç»‘å›¾ï¼ˆæ¨èå¤§æ•°æ®é‡ä½¿ç”¨ï¼‰
cerebro.plot(backend="plotly", style="candle")

# ä½¿ç”¨åŸæœ‰matplotlibåç«¯ï¼ˆé»˜è®¤ï¼‰
cerebro.plot(backend="matplotlib")
```

##### ä¿å­˜ä¸ºHTMLæ–‡ä»¶
```python
from backtrader.plot import PlotlyPlot

plotter = PlotlyPlot(style='candle')
figs = plotter.plot(results[0])
figs[0].write_html("backtrader_chart.html")
```

##### æ”¯æŒçš„åŠŸèƒ½
- **å›¾è¡¨ç±»å‹**: Kçº¿å›¾(`candle`)ã€OHLC(`bar`)ã€æŠ˜çº¿å›¾(`line`)
- **æˆäº¤é‡**: æ”¯æŒoverlayæˆ–ç‹¬ç«‹å­å›¾
- **æŠ€æœ¯æŒ‡æ ‡**: SMA, RSI, MACDç­‰è‡ªåŠ¨ç»˜åˆ¶
- **èŒƒå›´æ»‘å—**: åº•éƒ¨å¯¼èˆªæ¡æ–¹ä¾¿æµè§ˆ

---

## ğŸ“ˆ å›æµ‹æŠ¥å‘Šç”Ÿæˆ

ä¸€é”®ç”Ÿæˆä¸“ä¸šçš„å›æµ‹æŠ¥å‘Šï¼Œæ”¯æŒ HTMLã€PDFã€JSON ä¸‰ç§æ ¼å¼ã€‚

### åŸºæœ¬ä½¿ç”¨

```python
import backtrader as bt

cerebro = bt.Cerebro()
cerebro.addstrategy(MyStrategy)
cerebro.adddata(data)

# è‡ªåŠ¨æ·»åŠ æŠ¥å‘Šæ‰€éœ€çš„åˆ†æå™¨
cerebro.add_report_analyzers()

cerebro.run()

# ä¸€é”®ç”Ÿæˆ HTML æŠ¥å‘Š
cerebro.generate_report('report.html')

# ç”Ÿæˆ PDF æŠ¥å‘Š
cerebro.generate_report('report.pdf', format='pdf')

# ç”Ÿæˆ JSON æ•°æ®å¯¼å‡º
cerebro.generate_report('report.json', format='json')
```

### è‡ªå®šä¹‰æŠ¥å‘Šä¿¡æ¯

```python
cerebro.generate_report(
    'report.html',
    user='Trading John',           # ç”¨æˆ·å
    memo='Golden Cross Strategy'   # å¤‡æ³¨è¯´æ˜
)
```

### å•ç‹¬ä½¿ç”¨æ€§èƒ½è®¡ç®—å™¨

```python
from backtrader.reports import PerformanceCalculator, ReportGenerator

# è¿è¡Œç­–ç•¥
results = cerebro.run()
strategy = results[0]

# è·å–æ‰€æœ‰æ€§èƒ½æŒ‡æ ‡
calc = PerformanceCalculator(strategy)
metrics = calc.get_all_metrics()

print(f"å¤æ™®æ¯”ç‡: {metrics['sharpe_ratio']}")
print(f"æœ€å¤§å›æ’¤: {metrics['max_pct_drawdown']}%")
print(f"SQNè¯„çº§: {metrics['sqn_human']}")

# æ‰“å°æ€§èƒ½æ‘˜è¦
report = ReportGenerator(strategy)
report.print_summary()
```

### æŠ¥å‘ŠåŒ…å«çš„æŒ‡æ ‡

| ç±»åˆ« | æŒ‡æ ‡ |
|------|------|
| **æ”¶ç›ŠæŒ‡æ ‡** | åˆå§‹èµ„é‡‘ã€æœ€ç»ˆä»·å€¼ã€å‡€åˆ©æ¶¦ã€æ€»æ”¶ç›Šç‡ã€å¹´åŒ–æ”¶ç›Šç‡ã€ç›ˆåˆ©å› å­ |
| **é£é™©æŒ‡æ ‡** | æœ€å¤§å›æ’¤(é‡‘é¢/ç™¾åˆ†æ¯”)ã€å¤æ™®æ¯”ç‡ã€å¡ç›æ¯”ç‡ã€SQNåˆ†æ•° |
| **äº¤æ˜“ç»Ÿè®¡** | äº¤æ˜“æ€»æ•°ã€èƒœç‡ã€å¹³å‡ç›ˆåˆ©/äºæŸã€æœ€ä½³/æœ€å·®äº¤æ˜“ |

### SQN äººç±»è¯„çº§

| SQN åˆ†æ•° | è¯„çº§ |
|----------|------|
| < 1.6 | Poor (å·®) |
| 1.6 - 1.9 | Below Average (ä½äºå¹³å‡) |
| 1.9 - 2.4 | Average (å¹³å‡) |
| 2.4 - 2.9 | Good (è‰¯å¥½) |
| 2.9 - 5.0 | Excellent (ä¼˜ç§€) |
| 5.0 - 6.9 | Superb (å“è¶Š) |
| â‰¥ 7.0 | Holy Grail (åœ£æ¯) |

---

## ğŸ“ ç¤ºä¾‹ä»£ç 

`examples/` ç›®å½•ä¸‹æä¾›äº†å®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š

| ç¤ºä¾‹æ–‡ä»¶ | åŠŸèƒ½è¯´æ˜ |
|----------|----------|
| `example_plotly_charts.py` | Plotly äº¤äº’å¼å›¾è¡¨ï¼šé…è‰²æ–¹æ¡ˆã€ä¿å­˜HTML |
| `example_bokeh_charts.py` | Bokeh å›¾è¡¨ï¼šä¸»é¢˜ã€æ ‡ç­¾é¡µã€RecorderAnalyzer |
| `example_report_generation.py` | æŠ¥å‘Šç”Ÿæˆï¼šHTML/JSON/PDFæŠ¥å‘Šã€æ€§èƒ½æŒ‡æ ‡ |

### è¿è¡Œç¤ºä¾‹

```bash
# Plotly å›¾è¡¨ç¤ºä¾‹
python examples/example_plotly_charts.py

# Bokeh å›¾è¡¨ç¤ºä¾‹
python examples/example_bokeh_charts.py

# æŠ¥å‘Šç”Ÿæˆç¤ºä¾‹
python examples/example_report_generation.py
```

### ç¤ºä¾‹æ•ˆæœé¢„è§ˆ

**Plotly äº¤äº’å¼å›¾è¡¨**ï¼š
- æ”¯æŒç¼©æ”¾ã€å¹³ç§»ã€Hover æ•°æ®æ˜¾ç¤º
- Tableau ä¸“ä¸šé…è‰²æ–¹æ¡ˆ
- å¯¼å‡ºä¸ºç‹¬ç«‹ HTML æ–‡ä»¶

**å›æµ‹æŠ¥å‘Š**ï¼š
- ä¸“ä¸šçš„ HTML æŠ¥å‘Šé¡µé¢
- åŒ…å«æƒç›Šæ›²çº¿ã€å›æ’¤å›¾ã€æ”¶ç›ŠæŸ±çŠ¶å›¾
- SQN è¯„çº§å’Œå®Œæ•´æ€§èƒ½æŒ‡æ ‡

---

## ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Cerebro (å¼•æ“)                                  â”‚
â”‚  - ç®¡ç†ç­–ç•¥ã€æ•°æ®ã€ç»çºªå•†çš„ç”Ÿå‘½å‘¨æœŸ                                              â”‚
â”‚  - è¿è¡Œæ¨¡å¼: runonce (å‘é‡åŒ–) / äº‹ä»¶é©±åŠ¨                                        â”‚
â”‚  - è°ƒç”¨ _runonce() æˆ– _runnext() æ‰§è¡Œå›æµ‹                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DataFeed      â”‚         â”‚    Strategy     â”‚         â”‚     Broker      â”‚
â”‚   (æ•°æ®æº)       â”‚         â”‚    (ç­–ç•¥)        â”‚         â”‚    (ç»çºªå•†)      â”‚
â”‚                 â”‚         â”‚                 â”‚         â”‚                 â”‚
â”‚ - ç»§æ‰¿LineSeries â”‚         â”‚ - ç»§æ‰¿LineIteratorâ”‚        â”‚ - è®¢å•ç®¡ç†       â”‚
â”‚ - OHLCVæ•°æ®çº¿    â”‚         â”‚ - åŒ…å«Indicators â”‚         â”‚ - æŒä»“ç®¡ç†       â”‚
â”‚ - datetimeçº¿    â”‚         â”‚ - next()/once() â”‚         â”‚ - èµ„é‡‘ç®¡ç†       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚
          â”‚                           â–¼
          â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 â”‚   Indicator     â”‚
          â”‚                 â”‚   (æŒ‡æ ‡)         â”‚
          â”‚                 â”‚                 â”‚
          â”‚                 â”‚ - ç»§æ‰¿LineIteratorâ”‚
          â”‚                 â”‚ - è®¡ç®—æŠ€æœ¯æŒ‡æ ‡    â”‚
          â”‚                 â”‚ - once()/next() â”‚
          â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚
          â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Line ç³»ç»Ÿæ ¸å¿ƒç±»å±‚æ¬¡                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  LineRoot (åŸºç±»)                                                            â”‚
â”‚    â”œâ”€â”€ LineSingle (å•çº¿)                                                    â”‚
â”‚    â”‚     â””â”€â”€ LineBuffer (çº¿ç¼“å†²åŒº)                                          â”‚
â”‚    â”‚           â”œâ”€â”€ array: æ•°æ®å­˜å‚¨                                          â”‚
â”‚    â”‚           â”œâ”€â”€ _idx: å½“å‰ç´¢å¼•                                           â”‚
â”‚    â”‚           â”œâ”€â”€ lencount: æ•°æ®é•¿åº¦                                       â”‚
â”‚    â”‚           â””â”€â”€ __getitem__/__setitem__: æ•°æ®è®¿é—®                        â”‚
â”‚    â”‚                                                                        â”‚
â”‚    â””â”€â”€ LineMultiple (å¤šçº¿)                                                  â”‚
â”‚          â””â”€â”€ LineSeries (çº¿åºåˆ—)                                            â”‚
â”‚                â”œâ”€â”€ lines: Lineså¯¹è±¡(åŒ…å«å¤šä¸ªLineBuffer)                      â”‚
â”‚                â””â”€â”€ æ•°æ®æºã€æŒ‡æ ‡ã€ç­–ç•¥çš„åŸºç±»                                    â”‚
â”‚                                                                             â”‚
â”‚  LineActions (çº¿æ“ä½œåŸºç±»ï¼Œç»§æ‰¿LineBuffer)                                     â”‚
â”‚    â”œâ”€â”€ LinesOperation (äºŒå…ƒæ“ä½œ: a + b, a - b, a * b, a / b)                â”‚
â”‚    â”‚     â”œâ”€â”€ å­˜å‚¨æ“ä½œæ•° a, b å’Œæ“ä½œç¬¦                                        â”‚
â”‚    â”‚     â”œâ”€â”€ once(): å‘é‡åŒ–æ‰¹é‡è®¡ç®—                                          â”‚
â”‚    â”‚     â””â”€â”€ next(): é€barè®¡ç®—                                              â”‚
â”‚    â”‚                                                                        â”‚
â”‚    â””â”€â”€ LineOwnOperation (ä¸€å…ƒæ“ä½œ: -a, abs(a))                               â”‚
â”‚          â”œâ”€â”€ å­˜å‚¨æ“ä½œæ•° a å’Œæ“ä½œç¬¦                                           â”‚
â”‚          â””â”€â”€ once()/next(): è®¡ç®—æ–¹æ³•                                        â”‚
â”‚                                                                             â”‚
â”‚  LineIterator (çº¿è¿­ä»£å™¨ï¼Œç»§æ‰¿LineSeries)                                      â”‚
â”‚    â”œâ”€â”€ _lineiterators: å­æŒ‡æ ‡åˆ—è¡¨                                           â”‚
â”‚    â”œâ”€â”€ _once(): runonceæ¨¡å¼æ‰¹é‡å¤„ç†                                          â”‚
â”‚    â”œâ”€â”€ _next(): äº‹ä»¶é©±åŠ¨æ¨¡å¼é€barå¤„ç†                                        â”‚
â”‚    â””â”€â”€ Indicator/Strategy/Observer çš„åŸºç±»                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æ‰§è¡Œæµç¨‹ (runonceæ¨¡å¼)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. Cerebro._runonce(runstrats)                                             â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€ 2. strat._once(start, end)  # æ‰¹é‡é¢„è®¡ç®—æ‰€æœ‰æŒ‡æ ‡                      â”‚
â”‚     â”‚       â”‚                                                               â”‚
â”‚     â”‚       â”œâ”€â”€ éå† _lineiterators ä¸­çš„æ‰€æœ‰æŒ‡æ ‡                              â”‚
â”‚     â”‚       â”‚     â””â”€â”€ indicator._once(start, end)                           â”‚
â”‚     â”‚       â”‚           â”œâ”€â”€ è°ƒç”¨å­æŒ‡æ ‡çš„ _once()                             â”‚
â”‚     â”‚       â”‚           â”œâ”€â”€ è°ƒç”¨ preonce(), oncestart(), once()             â”‚
â”‚     â”‚       â”‚           â””â”€â”€ æ›´æ–° lencount, _idx                             â”‚
â”‚     â”‚       â”‚                                                               â”‚
â”‚     â”‚       â””â”€â”€ LinesOperation.once(start, end)  # Lineæ“ä½œçš„å‘é‡åŒ–è®¡ç®—       â”‚
â”‚     â”‚             â”œâ”€â”€ è°ƒç”¨ _parent_a._once() å’Œ _parent_b._once()            â”‚
â”‚     â”‚             â”œâ”€â”€ _once_op(): ä¸¤ä¸ªæ•°ç»„æ“ä½œ                               â”‚
â”‚     â”‚             â”œâ”€â”€ _once_val_op(): æ•°ç»„ä¸æ ‡é‡æ“ä½œ                          â”‚
â”‚     â”‚             â””â”€â”€ ç»“æœå­˜å…¥ self.array                                    â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€ 3. strat.reset()  # é‡ç½®æŒ‡é’ˆåˆ°èµ·å§‹ä½ç½®                                â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â”€ 4. å¾ªç¯æ¯ä¸ªbar:                                                      â”‚
â”‚           â”œâ”€â”€ data.advance()  # æ•°æ®å‰è¿›                                     â”‚
â”‚           â”œâ”€â”€ strat._oncepost(dt)                                           â”‚
â”‚           â”‚     â”œâ”€â”€ indicator.advance()  # æŒ‡æ ‡å‰è¿›                          â”‚
â”‚           â”‚     â”œâ”€â”€ strat.advance()  # ç­–ç•¥å‰è¿›                              â”‚
â”‚           â”‚     â””â”€â”€ strat.next()  # è°ƒç”¨ç”¨æˆ·ç­–ç•¥é€»è¾‘                          â”‚
â”‚           â””â”€â”€ brokerå¤„ç†è®¢å•                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            å…³é”®å±æ€§è¯´æ˜                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  _minperiod: æœ€å°å‘¨æœŸï¼ŒæŒ‡æ ‡éœ€è¦çš„æœ€å°‘æ•°æ®é‡æ‰èƒ½äº§ç”Ÿæœ‰æ•ˆå€¼                        â”‚
â”‚  _idx: å½“å‰ç´¢å¼•ä½ç½®ï¼Œç”¨äº __getitem__ è®¿é—®å½“å‰å€¼                               â”‚
â”‚  lencount: æ•°æ®é•¿åº¦è®¡æ•°ï¼Œlen(line) è¿”å›æ­¤å€¼                                   â”‚
â”‚  _clock: æ—¶é’Ÿæºï¼Œç”¨äºåŒæ­¥æ•°æ®å’ŒæŒ‡æ ‡                                            â”‚
â”‚  _owner: æ‹¥æœ‰è€…å¼•ç”¨ï¼ŒæŒ‡å‘åŒ…å«æ­¤å¯¹è±¡çš„çˆ¶å¯¹è±¡                                     â”‚
â”‚  _ltype: ç±»å‹æ ‡è¯† (IndType=0, StratType=1, ObsType=2)                        â”‚
â”‚  _opstage: æ“ä½œé˜¶æ®µ (1=å‘é‡åŒ–æ¨¡å¼, 2=äº‹ä»¶é©±åŠ¨æ¨¡å¼)                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


