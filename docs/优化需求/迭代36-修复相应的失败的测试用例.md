### 背景

重构代码之后，这个测试用例失败了，需要修复这个测试用例，分析定位bug在什么地方，然后修复

从这些失败的测试用例的运行结果来看，大概率是测试用例中使用的指标缺失相应的函数的问题，参考macd.py, atr.py等指标的实现方式，实现策略中使用的指标，并进行调试，确保策略能够通过
=========================== short test summary info ============================
FAILED tests/strategies/test_105_donchian_channel_strategy.py::test_donchian_channel_strategy - AssertionError: Expected final_value=99965.62, got 99983.54054995005
FAILED tests/strategies/test_108_keltner_channel_strategy.py::test_keltner_channel_strategy - AssertionError: Expected final_value=100039.51, got 100219.86669999998
FAILED tests/strategies/test_109_ultimate_oscillator_strategy.py::test_ultimate_oscillator_strategy - AssertionError: Expected bar_num=1229, got 1230
FAILED tests/strategies/test_117_price_channel_strategy.py::test_price_channel_strategy - AssertionError: Expected final_value=100050.36, got 100047.69622998998
FAILED tests/strategies/test_111_chandelier_exit_strategy.py::test_chandelier_exit_strategy - AssertionError: Expected final_value=100018.36, got 100212.05888999
FAILED tests/strategies/test_32_stochastic_sr_strategy.py::test_stochastic_sr_strategy - AssertionError: Expected bar_num=5398, got 5402
FAILED tests/strategies/test_44_signals_strategy.py::test_signals_strategy - AssertionError: Expected total_trades=21, got 0
FAILED tests/strategies/test_58_data_replay.py::test_data_replay - AssertionError: Expected final_value=108263.90, got 107605.40000000001
FAILED tests/strategies/test_66_donchian_channel_strategy.py::test_donchian_channel_strategy - AssertionError: Expected final_value=100000.0, got 100219.86669999998
FAILED tests/strategies/test_70_keltner_channel_strategy.py::test_keltner_channel_strategy - AssertionError: Expected final_value=100039.51, got 100219.86669999998
FAILED tests/strategies/test_78_percent_rank_strategy.py::test_percent_rank_strategy - AssertionError: Expected bar_num=3548, got 3573
FAILED tests/strategies/test_82_alligator_strategy.py::test_alligator_strategy - AssertionError: Expected final_value=100011.2, got 100203.75058999
FAILED tests/strategies/test_84_arjun_bhatia_futures_strategy.py::test_arjun_bhatia_futures_strategy - AssertionError: Expected final_value=100008.3, got 100008.91309996003
FAILED tests/strategies/test_94_mean_reversion_sma_strategy.py::test_mean_reversion_sma_strategy - AssertionError: Expected final_value=172375.61, got 158319.837331632
FAILED tests/strategies/test_96_ichimoku_cloud_strategy.py::test_ichimoku_cloud_strategy - AssertionError: Expected bar_num=1180, got 1206
FAILED tests/strategies/test_103_stochastic_strategy.py::test_stochastic_strategy - AssertionError: Expected bar_num=1239, got 1244
FAILED tests/strategies/test_104_cci_strategy.py::test_cci_strategy - AssertionError: Expected bar_num=1219, got 1238
============ 17 failed, 435 passed, 65 warnings in 70.84s (0:01:10) ============

============================================================
Test Summary
============================================================
Duration:     73s
Exit Code:    1
------------------------------------------------------------
Passed:       435
Failed:       17
Timeout:      0
------------------------------------------------------------
Status:       ❌ SOME TESTS FAILED

============================================================
Failed Tests:
============================================================
  FAILED tests/strategies/test_105_donchian_channel_strategy.py::test_donchian_channel_strategy - AssertionError: Expected final_value=99965.62, got 99983.54054995005
  FAILED tests/strategies/test_108_keltner_channel_strategy.py::test_keltner_channel_strategy - AssertionError: Expected final_value=100039.51, got 100219.86669999998
  FAILED tests/strategies/test_109_ultimate_oscillator_strategy.py::test_ultimate_oscillator_strategy - AssertionError: Expected bar_num=1229, got 1230
  FAILED tests/strategies/test_117_price_channel_strategy.py::test_price_channel_strategy - AssertionError: Expected final_value=100050.36, got 100047.69622998998
  FAILED tests/strategies/test_111_chandelier_exit_strategy.py::test_chandelier_exit_strategy - AssertionError: Expected final_value=100018.36, got 100212.05888999
  FAILED tests/strategies/test_32_stochastic_sr_strategy.py::test_stochastic_sr_strategy - AssertionError: Expected bar_num=5398, got 5402
  FAILED tests/strategies/test_44_signals_strategy.py::test_signals_strategy - AssertionError: Expected total_trades=21, got 0
  FAILED tests/strategies/test_58_data_replay.py::test_data_replay - AssertionError: Expected final_value=108263.90, got 107605.40000000001
  FAILED tests/strategies/test_66_donchian_channel_strategy.py::test_donchian_channel_strategy - AssertionError: Expected final_value=100000.0, got 100219.86669999998
  FAILED tests/strategies/test_70_keltner_channel_strategy.py::test_keltner_channel_strategy - AssertionError: Expected final_value=100039.51, got 100219.86669999998
  FAILED tests/strategies/test_78_percent_rank_strategy.py::test_percent_rank_strategy - AssertionError: Expected bar_num=3548, got 3573
  FAILED tests/strategies/test_82_alligator_strategy.py::test_alligator_strategy - AssertionError: Expected final_value=100011.2, got 100203.75058999
  FAILED tests/strategies/test_84_arjun_bhatia_futures_strategy.py::test_arjun_bhatia_futures_strategy - AssertionError: Expected final_value=100008.3, got 100008.91309996003
  FAILED tests/strategies/test_94_mean_reversion_sma_strategy.py::test_mean_reversion_sma_strategy - AssertionError: Expected final_value=172375.61, got 158319.837331632
  FAILED tests/strategies/test_96_ichimoku_cloud_strategy.py::test_ichimoku_cloud_strategy - AssertionError: Expected bar_num=1180, got 1206
  FAILED tests/strategies/test_103_stochastic_strategy.py::test_stochastic_strategy - AssertionError: Expected bar_num=1239, got 1244
  FAILED tests/strategies/test_104_cci_strategy.py::test_cci_strategy - AssertionError: Expected bar_num=1219, got 1238
### 修复方法建议
1. backtrader/run_test_with_log.py 这个运行这个策略，然后对比master分支上的结果，看看origin分支上的结果究竟差在哪里，然后去定位。
2. 如果必要，可以修改测试用例，增加注释，然后方便在两个分支上进行对比。

### 限制

1. 不允许修改测试用例，尤其是测试用例的期望值。
2. 修改过源代码重新测试的时候，最好pip install -U . 重新安装一下。