
å¯¹æ¯”æ–‡ä»¶:
  Masterç‰ˆæœ¬: performance_profile_master_20251027_212037.log
  Removeç‰ˆæœ¬: performance_profile_remove-metaprogramming_20251027_214230.log

====================================================================================================
å®Œæ•´æ€§èƒ½å¯¹æ¯”åˆ†æ
====================================================================================================

================================================================================
è§£ææ–‡ä»¶: performance_profile_master_20251027_212037.log
================================================================================


================================================================================
è§£ææ–‡ä»¶: performance_profile_remove-metaprogramming_20251027_214230.log
================================================================================


### æ€»ä½“æ€§èƒ½ç»Ÿè®¡å¯¹æ¯”

æŒ‡æ ‡                                         Masterç‰ˆæœ¬             Removeç‰ˆæœ¬              å˜åŒ–        å˜åŒ–ç‡
----------------------------------------------------------------------------------------------------
total_calls                             114,083,132          195,811,418      81,728,286      71.6%
primitive_calls                         123,933,231          202,218,252      78,285,021      63.2%
unique_funcs                                  6,245                7,323           1,078      17.3%
total_time (seconds)                          33.42                58.52           25.11      75.1%

### TOP 50 æ€§èƒ½ä¸‹é™æœ€ä¸¥é‡çš„å‡½æ•°ï¼ˆæŒ‰tottimeå¢é‡æ’åºï¼‰

æ’å    å‡½æ•°ä½ç½®                                                                                Master(s)    Remove(s)        å¢é‡(s)        å¢é•¿ç‡
-------------------------------------------------------------------------------------------------------------------------------------------------
1     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:784(          0.000        4.357        4.357        NEW
2     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:969(          0.000        3.661        3.661        NEW
3     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:876(          0.000        3.346        3.346        NEW
4     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:381(          0.000        2.917        2.917        NEW
5     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:441(          0.000        2.457        2.457        NEW
6     {built-in method builtins.hasattr}                                                      0.030        2.255        2.225     +7417%
7     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineiterator.py:12          0.000        1.597        1.597        NEW
8     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/indicators/sma.py:          0.000        1.379        1.379        NEW
9     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/cerebro.py:1746(_r          0.000        1.378        1.378        NEW
10    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:301(          0.000        1.352        1.352        NEW
11    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/feed.py:432(_tick_          0.000        1.291        1.291        NEW
12    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:229(          0.000        1.157        1.157        NEW
13    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:541(          0.000        1.078        1.078        NEW
14    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/brokers/bbroker.py          0.000        0.913        0.913        NEW
15    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:542(          0.000        0.886        0.886        NEW
16    {built-in method builtins.isinstance}                                                   0.000        0.877        0.877        NEW
17    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/indicators/sma.py:          0.000        0.873        0.873        NEW
18    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/feeds/btcsv.py:21(          0.000        0.840        0.840        NEW
19    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:957(          0.000        0.739        0.739        NEW
20    {built-in method builtins.getattr}                                                      0.468        1.185        0.717      +153%
21    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/utils/dateintern.p          0.000        0.699        0.699        NEW
22    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:121(          0.000        0.688        0.688        NEW
23    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/indicators/sma.py:          0.000        0.661        0.661        NEW
24    {built-in method builtins.setattr}                                                      0.212        0.842        0.630      +297%
25    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:1190          0.000        0.623        0.623        NEW
26    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/brokers/bbroker.py          0.000        0.598        0.598        NEW
27    {built-in method math.isnan}                                                            0.000        0.548        0.548        NEW
28    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/indicators/sma.py:          0.000        0.536        0.536        NEW
29    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:127(          0.000        0.527        0.527        NEW
30    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/indicators/sma.py:          0.000        0.521        0.521        NEW
31    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:122(          0.000        0.511        0.511        NEW
32    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/strategy.py:951(_n          0.000        0.500        0.500        NEW
33    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/comminfo.py:150(__          0.000        0.494        0.494        NEW
34    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineiterator.py:16          0.000        0.439        0.439        NEW
35    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/feed.py:420(_tick_          0.000        0.439        0.439        NEW
36    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/parameters.py:1314          0.000        0.409        0.409        NEW
37    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:511(          0.000        0.381        0.381        NEW
38    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/feed.py:450(advanc          0.000        0.371        0.371        NEW
39    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineiterator.py:11          0.000        0.337        0.337        NEW
40    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/indicator.py:203(o          0.000        0.324        0.324        NEW
41    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/parameters.py:272(          0.000        0.305        0.305        NEW
42    /Users/yunjinqi/opt/anaconda3/lib/python3.11/site-packages/numpy/core/_methods          0.000        0.301        0.301        NEW
43    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:535(          0.000        0.300        0.300        NEW
44    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/feed.py:561(load)           0.000        0.279        0.279        NEW
45    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/indicators/crossov          0.000        0.267        0.267        NEW
46    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/strategy.py:672(_n          0.000        0.258        0.258        NEW
47    {method 'startswith' of 'str' objects}                                                  0.000        0.238        0.238        NEW
48    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:1061          0.000        0.229        0.229        NEW
49    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/metabase.py:1202(p          0.000        0.227        0.227        NEW
50    {method 'get' of 'dict' objects}                                                        0.000        0.214        0.214        NEW

### TOP 30 è°ƒç”¨æ¬¡æ•°å¢åŠ æœ€å¤šçš„å‡½æ•°

æ’å    å‡½æ•°ä½ç½®                                                                                    Masteræ¬¡æ•°        Removeæ¬¡æ•°              å¢é‡        å¢é•¿ç‡
------------------------------------------------------------------------------------------------------------------------------------------------------
1     {built-in method builtins.hasattr}                                                       352,382      21,672,655      21,320,273     +6050%
2     {built-in method builtins.isinstance}                                                          0      20,174,868      20,174,868        NEW
3     {built-in method math.isnan}                                                                   0      10,954,492      10,954,492        NEW
4     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:229(                 0       9,449,476       9,449,476        NEW
5     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:381(                 0       8,397,480       8,397,480        NEW
6     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:876(                 0       8,137,580       8,137,580        NEW
7     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:122(                 0       7,146,040       7,146,040        NEW
8     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:969(                 0       5,770,820       5,770,820        NEW
9     /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:121(                 0       5,703,040       5,703,040        NEW
10    {built-in method builtins.getattr}                                                     3,054,733       8,647,232       5,592,499      +183%
11    {method 'get' of 'dict' objects}                                                               0       3,626,336       3,626,336        NEW
12    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:127(                 0       3,505,432       3,505,432        NEW
13    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:784(                 0       3,255,140       3,255,140        NEW
14    {method 'append' of 'list' objects}                                                      487,288       3,097,872       2,610,584      +536%
15    {built-in method builtins.setattr}                                                     1,363,602       3,813,989       2,450,387      +180%
16    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:207(                 0       2,299,240       2,299,240        NEW
17    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:957(                 0       2,294,120       2,294,120        NEW
18    {method 'startswith' of 'str' objects}                                                         0       2,165,029       2,165,029        NEW
19    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/comminfo.py:150(__                 0       2,021,214       2,021,214        NEW
20    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:541(                 0       1,862,000       1,862,000        NEW
21    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:301(                 0       1,788,040       1,788,040        NEW
22    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/parameters.py:272(                 0       1,668,170       1,668,170        NEW
23    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/linebuffer.py:441(                 0       1,616,080       1,616,080        NEW
24    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/parameters.py:1314                 0       1,325,673       1,325,673        NEW
25    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/metabase.py:1202(p                 0       1,287,248       1,287,248        NEW
26    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:542(                 0       1,046,628       1,046,628        NEW
27    {built-in method builtins.callable}                                                            0         786,761         786,761        NEW
28    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineseries.py:206(                 0         770,853         770,853        NEW
29    {built-in method builtins.delattr}                                                             0         695,666         695,666        NEW
30    /Users/yunjinqi/Documents/source_code/backtrader/backtrader/lineiterator.py:12                 0         694,760         694,760        NEW

### å…³é”®æ€§èƒ½ç“¶é¢ˆè¯†åˆ«

#### å†…å»ºå‡½æ•°è°ƒç”¨å¯¹æ¯”

     hasattr: Master=     352,382æ¬¡/   0.030s  Remove=  21,672,655æ¬¡/   2.255s  å¢åŠ =  21,320,273æ¬¡/  2.225s (  6050.3%)
     getattr: Master=   3,054,733æ¬¡/   0.468s  Remove=   8,647,232æ¬¡/   1.185s  å¢åŠ =   5,592,499æ¬¡/  0.717s (   183.1%)
     setattr: Master=   1,363,602æ¬¡/   0.212s  Remove=   3,813,989æ¬¡/   0.842s  å¢åŠ =   2,450,387æ¬¡/  0.630s (   179.7%)
  isinstance: Master=           0æ¬¡/   0.000s  Remove=  20,174,868æ¬¡/   0.877s  å¢åŠ =  20,174,868æ¬¡/  0.877s (     inf%)
         len: Master=  16,466,877æ¬¡/   2.412s  Remove=  22,941,206æ¬¡/   1.843s  å¢åŠ =   6,474,329æ¬¡/ -0.569s (    39.3%)

====================================================================================================
ä¼˜åŒ–å»ºè®®å’ŒTODOæ¸…å•
====================================================================================================

åŸºäºè¯¦ç»†åˆ†æï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åºçš„ä¼˜åŒ–TODOæ¸…å•ï¼š

## ğŸ”´ ç´§æ€¥ä¼˜åŒ–ï¼ˆé¢„è®¡æ¢å¤40-50%æ€§èƒ½ï¼‰

### TODO 1: ä¼˜åŒ–hasattr/getattr/setattrè°ƒç”¨ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
- [ ] 1.1 åœ¨lineseries.__getattr__ä¸­å®ç°å±æ€§ç¼“å­˜
- [ ] 1.2 åœ¨lineseries.__setattr__ä¸­å‡å°‘hasattræ£€æŸ¥
- [ ] 1.3 åœ¨lineiteratorä¸­ç»§ç»­å‡å°‘hasatträ½¿ç”¨ï¼ˆå·²éƒ¨åˆ†å®Œæˆï¼‰
- [ ] 1.4 åœ¨æ‰€æœ‰çƒ­è·¯å¾„ä¸­ç”¨try-exceptæ›¿ä»£hasattr
é¢„æœŸæ”¶ç›Š: å‡å°‘1500ä¸‡+å‡½æ•°è°ƒç”¨ï¼ŒèŠ‚çœ8-12ç§’

### TODO 2: ä¼˜åŒ–lineseries.__getitem__
- [ ] 2.1 ç§»é™¤isinstance(value, float)æ£€æŸ¥
- [ ] 2.2 ç§»é™¤math.isnan()è°ƒç”¨ï¼Œä½¿ç”¨value != valueæ£€æŸ¥
- [ ] 2.3 ç®€åŒ–å¼‚å¸¸å¤„ç†é€»è¾‘
é¢„æœŸæ”¶ç›Š: å‡å°‘2000ä¸‡+å‡½æ•°è°ƒç”¨ï¼ŒèŠ‚çœ3-5ç§’

### TODO 3: ä¼˜åŒ–å‚æ•°ç³»ç»Ÿ
- [ ] 3.1 åœ¨Parametersç±»åˆå§‹åŒ–æ—¶é¢„åˆ›å»ºæ‰€æœ‰å‚æ•°å±æ€§
- [ ] 3.2 é¿å…get_param/getæ–¹æ³•çš„é‡å¤è°ƒç”¨
- [ ] 3.3 ä½¿ç”¨__slots__ä¼˜åŒ–Parameterså¯¹è±¡
é¢„æœŸæ”¶ç›Š: å‡å°‘300ä¸‡+å‡½æ•°è°ƒç”¨ï¼ŒèŠ‚çœ2-4ç§’

## ğŸŸ¡ é‡è¦ä¼˜åŒ–ï¼ˆé¢„è®¡æ¢å¤20-30%æ€§èƒ½ï¼‰

### TODO 4: å®ç°æ™ºèƒ½å±æ€§ç¼“å­˜
- [ ] 4.1 è®¾è®¡ç¼“å­˜ç­–ç•¥ï¼ˆLRUæˆ–ç®€å•å­—å…¸ï¼‰
- [ ] 4.2 åœ¨__getattr__é¦–æ¬¡è®¿é—®åç¼“å­˜åˆ°__dict__
- [ ] 4.3 ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
é¢„æœŸæ”¶ç›Š: å‡å°‘1000ä¸‡+å‡½æ•°è°ƒç”¨ï¼ŒèŠ‚çœ3-5ç§’

### TODO 5: ä¼˜åŒ–lineè®¿é—®æ¨¡å¼
- [ ] 5.1 é‡æ–°å¼•å…¥æœ‰é™çš„æè¿°ç¬¦ï¼ˆä¸ä½¿ç”¨å…ƒç±»ï¼‰
- [ ] 5.2 é¢„ç¼–è¯‘å¸¸ç”¨çš„lineè®¿é—®è·¯å¾„
- [ ] 5.3 å‡å°‘åŠ¨æ€å±æ€§æŸ¥æ‰¾
é¢„æœŸæ”¶ç›Š: å‡å°‘500ä¸‡+å‡½æ•°è°ƒç”¨ï¼ŒèŠ‚çœ2-3ç§’

### TODO 6: å‡å°‘å¯¹è±¡åˆ›å»ºå¼€é”€
- [ ] 6.1 ä¸ºå°å¯¹è±¡ä½¿ç”¨__slots__
- [ ] 6.2 å¯¹è±¡æ± åŒ–é¢‘ç¹åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡
- [ ] 6.3 å»¶è¿Ÿåˆå§‹åŒ–éå…³é”®å±æ€§
é¢„æœŸæ”¶ç›Š: èŠ‚çœ1-2ç§’

## ğŸŸ¢ é•¿æœŸä¼˜åŒ–ï¼ˆéœ€è¦æ¶æ„è¯„ä¼°ï¼‰

### TODO 7: è€ƒè™‘éƒ¨åˆ†æ¢å¤å…ƒç±»
- [ ] 7.1 è¯„ä¼°åœ¨å…³é”®è·¯å¾„ä½¿ç”¨è½»é‡çº§å…ƒç±»çš„å¯è¡Œæ€§
- [ ] 7.2 è®¾è®¡æ··åˆæ¶æ„ï¼ˆå…ƒç±»+éå…ƒç±»ï¼‰
- [ ] 7.3 æ€§èƒ½vså¤æ‚åº¦æƒè¡¡åˆ†æ

### TODO 8: Cæ‰©å±•ä¼˜åŒ–
- [ ] 8.1 è¯†åˆ«æœ€çƒ­çš„è·¯å¾„
- [ ] 8.2 ç”¨Cythoné‡å†™å…³é”®å‡½æ•°
- [ ] 8.3 ä¿æŒPythonæ¥å£å…¼å®¹æ€§

## æ‰§è¡Œé¡ºåºå»ºè®®

ç¬¬ä¸€è½®ï¼ˆé¢„è®¡2-3å¤©ï¼‰ï¼š
1. å®ŒæˆTODO 1.1-1.4ï¼ˆhasatträ¼˜åŒ–ï¼‰
2. å®ŒæˆTODO 2.1-2.3ï¼ˆ__getitem__ä¼˜åŒ–ï¼‰
3. è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Œé¢„æœŸé™è‡³45-48ç§’

ç¬¬äºŒè½®ï¼ˆé¢„è®¡1-2å¤©ï¼‰ï¼š
1. å®ŒæˆTODO 3.1-3.3ï¼ˆå‚æ•°ç³»ç»Ÿä¼˜åŒ–ï¼‰
2. å®ŒæˆTODO 4.1-4.3ï¼ˆå±æ€§ç¼“å­˜ï¼‰
3. è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Œé¢„æœŸé™è‡³38-42ç§’

ç¬¬ä¸‰è½®ï¼ˆé¢„è®¡2-3å¤©ï¼‰ï¼š
1. å®ŒæˆTODO 5å’Œ6
2. è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼Œé¢„æœŸé™è‡³35-38ç§’
3. æ¥è¿‘masterç‰ˆæœ¬æ€§èƒ½ï¼ˆ33.42ç§’ï¼‰

æ¯è½®ä¼˜åŒ–åéƒ½è¦ï¼š
- è¿è¡Œæ€§èƒ½æµ‹è¯•
- å¯¹æ¯”æ—¥å¿—æ–‡ä»¶
- éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§
- æäº¤ä»£ç 
    
